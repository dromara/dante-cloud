<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Data JPA | Eurynome Cloud</title>
    <meta name="generator" content="VuePress 1.8.2">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <link rel="icon" href="/images/logo.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <script>var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?119907dbb0a3ccc92ebe5e91decd896f";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();</script>
    <link rel="alternate" type="application/atom+xml" href="https://herodotus.cn/atom.xml" title="Eurynome Cloud Atom Feed">
    <link rel="alternate" type="application/json" href="https://herodotus.cn/feed.json" title="Eurynome Cloud JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://herodotus.cn/rss.xml" title="Eurynome Cloud RSS Feed">
    <link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png">
    <meta name="description" content="Eurynome Cloud ä¼ä¸šçº§å¾®æœåŠ¡æ¶æ„å’ŒæœåŠ¡èƒ½åŠ›å¼€å‘å¹³å°åœ¨çº¿æ–‡æ¡£">
    <meta property="og:url" content="/knowledge/spring-data-jpa.html">
    <meta property="og:site_name" content="Eurynome Cloud">
    <meta property="og:title" content="Spring Data JPA">
    <meta property="og:description" content="Spring Data JPA JPA JPA(Java Persistence API)æ„å³JavaæŒä¹…åŒ–APIï¼Œæ˜¯Sunå®˜æ–¹åœ¨JDK5.0åæå‡ºçš„JavaæŒä¹…åŒ–è§„èŒƒï¼ˆJSR 338ï¼Œè¿™äº›æ¥å£æ‰€åœ¨åŒ…ä¸ºjavax.persistenceï¼Œè¯¦ç»†å†…å®¹å¯å‚è€ƒï¼‰ JPAçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–æŒä¹…å±‚å¼€å‘ä»¥åŠæ•´åˆORMæŠ€æœ¯ï¼Œç»“æŸ Hibernate,TopLink,JDO">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Eurynome Cloud">
    <meta property="article:author" content="ç åŒ å›">
    <meta name="keywords" content="Eurynome Cloud,å¾®æœåŠ¡,Spring Boot,Spirng Cloud,Spring Cloud Alibaba,Spring Security,OAuth2,Nacos,Skywalking,Sentinel,Seata">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    
    <link rel="preload" href="/assets/css/0.styles.9c297bd2.css" as="style"><link rel="preload" href="/assets/js/app.572add54.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.2bc900be.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.5e4e4962.js" as="script"><link rel="preload" href="/assets/js/page-SpringDataJPA.848e4b12.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.52f8b761.js" as="script"><link rel="prefetch" href="/assets/js/44.20063a91.js"><link rel="prefetch" href="/assets/js/45.f9d4db61.js"><link rel="prefetch" href="/assets/js/46.3e9347ca.js"><link rel="prefetch" href="/assets/js/47.ffd531df.js"><link rel="prefetch" href="/assets/js/48.60e62d26.js"><link rel="prefetch" href="/assets/js/49.420eac07.js"><link rel="prefetch" href="/assets/js/layout-Blog.ee80b804.js"><link rel="prefetch" href="/assets/js/layout-Layout.54347a9b.js"><link rel="prefetch" href="/assets/js/layout-NotFound.05d7a435.js"><link rel="prefetch" href="/assets/js/layout-Slide.adf8cbb1.js"><link rel="prefetch" href="/assets/js/page-EurynomeCloudåœ¨çº¿æ–‡æ¡£.67c65f2d.js"><link rel="prefetch" href="/assets/js/page-Idea.947eaf54.js"><link rel="prefetch" href="/assets/js/page-MySQLå¸¸è§é—®é¢˜.4f42cc65.js"><link rel="prefetch" href="/assets/js/page-Nacoså¸¸è§é—®é¢˜.cfe1f492.js"><link rel="prefetch" href="/assets/js/page-OAuth2æˆæƒå¼€æ”¾æ ‡å‡†.5a7ca219.js"><link rel="prefetch" href="/assets/js/page-Rediså¸¸è§é—®é¢˜.dd4645bc.js"><link rel="prefetch" href="/assets/js/page-ä¸ºä»€ä¹ˆé»˜è®¤ä½¿ç”¨PostgreSQLæ•°æ®åº“ï¼Ÿ.88dae2b2.js"><link rel="prefetch" href="/assets/js/page-äº†è§£åŸºç¡€çŸ¥è¯†.d02a8f78.js"><link rel="prefetch" href="/assets/js/page-ä¾èµ–ç»„ä»¶.3f57029e.js"><link rel="prefetch" href="/assets/js/page-å‰ç«¯æ¦‚è§ˆ.87041b5e.js"><link rel="prefetch" href="/assets/js/page-å‰ç«¯é—®é¢˜.a566b77b.js"><link rel="prefetch" href="/assets/js/page-å‰è¨€.ed0e4309.js"><link rel="prefetch" href="/assets/js/page-å¤šç¯å¢ƒé…ç½®.40008856.js"><link rel="prefetch" href="/assets/js/page-å®¹å™¨åŒ–æŠ€æœ¯.8925bd20.js"><link rel="prefetch" href="/assets/js/page-å®¹å™¨åŒ–éƒ¨ç½².538b0ada.js"><link rel="prefetch" href="/assets/js/page-å¸¸ç”¨å‘½ä»¤.97b3dd03.js"><link rel="prefetch" href="/assets/js/page-å¿«é€Ÿäº†è§£.ea72c794.js"><link rel="prefetch" href="/assets/js/page-æŒ‡å—.fc854b49.js"><link rel="prefetch" href="/assets/js/page-æ•°æ®åˆå§‹åŒ–.2b81fc33.js"><link rel="prefetch" href="/assets/js/page-æ–°å»ºå­æ¨¡å—.201a15ec.js"><link rel="prefetch" href="/assets/js/page-æ›´æ¢æ•°æ®åº“.a03142b1.js"><link rel="prefetch" href="/assets/js/page-æ›´æ–°æ—¥å¿—.3afecd4e.js"><link rel="prefetch" href="/assets/js/page-æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º.f5fc3f79.js"><link rel="prefetch" href="/assets/js/page-æ³¨æ„äº‹é¡¹.4e357b65.js"><link rel="prefetch" href="/assets/js/page-æ·»åŠ æ¨¡å—.d291b902.js"><link rel="prefetch" href="/assets/js/page-ç¯å¢ƒéƒ¨ç½².5bd4a82e.js"><link rel="prefetch" href="/assets/js/page-ç³»ç»Ÿé…ç½®.6e0a6dca.js"><link rel="prefetch" href="/assets/js/page-ç»„ä»¶é…ç½®.4a317790.js"><link rel="prefetch" href="/assets/js/page-é…ç½®.a872e81e.js"><link rel="prefetch" href="/assets/js/page-é¡¹ç›®ä»‹ç».1f81f5d9.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.b992525d.js"><link rel="prefetch" href="/assets/js/vendors~mermaid.e92410ac.js"><link rel="prefetch" href="/assets/js/vendors~photo-swipe.9805af50.js"><link rel="prefetch" href="/assets/js/vendors~reveal.dc3d3187.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9c297bd2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Eurynome Cloud" class="logo"> <!----> <span class="site-name can-hide">Eurynome Cloud</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><button tabindex="-1" aria-hidden="true" class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">ä¸»é¢˜è‰²:</label> <li><span class="default-theme"></span></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">ä¸»é¢˜æ¨¡å¼:</label> <div class="darkmode-switch"><div class="item day"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon"><path d="M512 256a42.667 42.667 0 0 0 42.667-42.667V128a42.667 42.667 0 0 0-85.334 0v85.333A42.667 42.667 0 0 0 512 256zm384 213.333h-85.333a42.667 42.667 0 0 0 0 85.334H896a42.667 42.667 0 0 0 0-85.334zM256 512a42.667 42.667 0 0 0-42.667-42.667H128a42.667 42.667 0 0 0 0 85.334h85.333A42.667 42.667 0 0 0 256 512zm9.387-298.667a42.667 42.667 0 0 0-59.307 62.72l61.44 59.307a42.667 42.667 0 0 0 31.147 11.947 42.667 42.667 0 0 0 30.72-13.227 42.667 42.667 0 0 0 0-60.16zm459.946 133.974a42.667 42.667 0 0 0 29.44-11.947l61.44-59.307a42.667 42.667 0 0 0-57.6-62.72l-61.44 60.587a42.667 42.667 0 0 0 0 60.16 42.667 42.667 0 0 0 28.16 13.227zM512 768a42.667 42.667 0 0 0-42.667 42.667V896a42.667 42.667 0 0 0 85.334 0v-85.333A42.667 42.667 0 0 0 512 768zm244.48-79.36a42.667 42.667 0 0 0-59.307 61.44l61.44 60.587a42.667 42.667 0 0 0 29.44 11.946 42.667 42.667 0 0 0 30.72-12.8 42.667 42.667 0 0 0 0-60.586zm-488.96 0-61.44 59.307a42.667 42.667 0 0 0 0 60.586 42.667 42.667 0 0 0 30.72 12.8 42.667 42.667 0 0 0 28.587-10.666l61.44-59.307a42.667 42.667 0 0 0-59.307-61.44zM512 341.333A170.667 170.667 0 1 0 682.667 512 170.667 170.667 0 0 0 512 341.333z" fill="currentColor"></path></svg></div> <div class="item auto active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon"><path d="M460.864 539.072H564.8L510.592 376l-49.728 163.072zM872 362.368V149.504H659.648L510.528 0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504 149.12-149.504h212.352V661.376l149.12-149.504L872 362.368zM614.464 693.12l-31.616-90.624H438.272l-31.616 90.624h-85.888l144.576-407.68h90.368l144.576 407.68h-85.824zm0 0" fill="currentColor"></path></svg></div> <div class="item night"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon"><path d="M935.539 630.402c-11.43-11.432-28.674-14.739-43.531-8.354-46.734 20.103-96.363 30.297-147.508 30.297-99.59 0-193.221-38.784-263.64-109.203-108.637-108.637-139.61-270.022-78.908-411.148a39.497 39.497 0 0 0-51.886-51.887c-52.637 22.64-100.017 54.81-140.826 95.616-85.346 85.346-132.346 198.821-132.346 319.52 0 120.7 47.001 234.172 132.347 319.519S408.063 947.11 528.76 947.11c120.7 0 234.172-47.003 319.52-132.351 40.809-40.81 72.978-88.19 95.616-140.826a39.497 39.497 0 0 0-8.356-43.532z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></button> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  æŒ‡å—
</a></div><div class="nav-item"><a href="/config/" class="nav-link"><i class="iconfont icon-config"></i>
  é…ç½®
</a></div><div class="nav-item"><a href="/monomer/" class="nav-link"><i class="iconfont icon-time"></i>
  å•ä½“ç‰ˆ
</a></div><div class="nav-item"><a href="/microservices/" class="nav-link"><i class="iconfont icon-workingDirectory"></i>
  å¾®æœåŠ¡æŠ€æœ¯æ ˆ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="äº†è§£æ›´å¤š" class="dropdown-title"><span class="title"><i class="iconfont icon-leaf"></i>
        äº†è§£æ›´å¤š
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å»¶ä¼¸</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/knowledge/" class="nav-link router-link-active active"><!---->
  äº†è§£åŸºç¡€çŸ¥è¯†
</a></li><li class="dropdown-subitem"><a href="/knowledge/postgresql.html" class="nav-link"><!---->
  äº†è§£PostgreSQL
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¸®åŠ©</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://gitee.com/herodotus/eurynome-cloud/issues" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  æˆ‘è¦æé—®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/others/" class="nav-link"><!---->
  å¸¸è§é—®é¢˜
</a></li><li class="dropdown-subitem"><a href="/others/update-log.html" class="nav-link"><!---->
  æ›´æ–°æ—¥å¿—
</a></li><li class="dropdown-subitem"><a href="https://jq.qq.com/?_wv=1027&amp;k=bIerJVy8" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  åŠ å…¥QQç¾¤
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/herodotus/eurynome-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div></nav> <!----> <a rel="noopener noreferrer" href="https://github.com/herodotus-cloud/eurynome-cloud" target="_blank" class="repo-link can-hide">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><a href="/" class="nav-link router-link-active"><i class="iconfont icon-home"></i>
  é¦–é¡µ
</a></div><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont icon-creative"></i>
  æŒ‡å—
</a></div><div class="nav-item"><a href="/config/" class="nav-link"><i class="iconfont icon-config"></i>
  é…ç½®
</a></div><div class="nav-item"><a href="/monomer/" class="nav-link"><i class="iconfont icon-time"></i>
  å•ä½“ç‰ˆ
</a></div><div class="nav-item"><a href="/microservices/" class="nav-link"><i class="iconfont icon-workingDirectory"></i>
  å¾®æœåŠ¡æŠ€æœ¯æ ˆ
</a></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="äº†è§£æ›´å¤š" class="dropdown-title"><span class="title"><i class="iconfont icon-leaf"></i>
      äº†è§£æ›´å¤š
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å»¶ä¼¸</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/knowledge/" class="nav-link router-link-active active"><!---->
  äº†è§£åŸºç¡€çŸ¥è¯†
</a></li><li class="dropdown-subitem"><a href="/knowledge/postgresql.html" class="nav-link"><!---->
  äº†è§£PostgreSQL
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å¸®åŠ©</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://gitee.com/herodotus/eurynome-cloud/issues" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  æˆ‘è¦æé—®
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="/others/" class="nav-link"><!---->
  å¸¸è§é—®é¢˜
</a></li><li class="dropdown-subitem"><a href="/others/update-log.html" class="nav-link"><!---->
  æ›´æ–°æ—¥å¿—
</a></li><li class="dropdown-subitem"><a href="https://jq.qq.com/?_wv=1027&amp;k=bIerJVy8" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  åŠ å…¥QQç¾¤
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://gitee.com/herodotus/eurynome-cloud" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a rel="noopener noreferrer" href="https://github.com/herodotus-cloud/eurynome-cloud" target="_blank" class="repo-link">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><a href="/knowledge/" aria-current="page" class="sidebar-link"><i class="iconfont icon-leaf"></i>äº†è§£åŸºç¡€çŸ¥è¯†</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading clickable open"><!----> <span class="title">åŸºç¡€çŸ¥è¯†</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge/dev-environment/" class="sidebar-link"><i class="iconfont icon-navigation"></i>æœ¬åœ°å¼€å‘ç¯å¢ƒæ­å»º</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#java-å¼€å‘ç¯å¢ƒ" class="sidebar-link">Java å¼€å‘ç¯å¢ƒ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_1-jdk-å®‰è£…åŠé…ç½®" class="sidebar-link heading3">[1],JDK å®‰è£…åŠé…ç½®</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_2-maven-å®‰è£…åŠé…ç½®" class="sidebar-link heading3">[2],Maven å®‰è£…åŠé…ç½®</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_3-git-å®‰è£…" class="sidebar-link heading3">[3],Git å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_4-idea-å®‰è£…åŠé…ç½®" class="sidebar-link heading3">[4],Idea å®‰è£…åŠé…ç½®</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_5-æ£€å‡ºä»£ç å’Œç¼–è¯‘" class="sidebar-link heading3">[5],æ£€å‡ºä»£ç å’Œç¼–è¯‘</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#node-å¼€å‘ç¯å¢ƒ" class="sidebar-link">Node å¼€å‘ç¯å¢ƒ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_1-nodejs-å®‰è£…" class="sidebar-link heading3">[1],Nodejs å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_2-nodejs-é…ç½®" class="sidebar-link heading3">[2],Nodejs é…ç½®</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_3-yarn-ç®€ä»‹" class="sidebar-link heading3">[3],Yarn ç®€ä»‹</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_4-yarn-å®‰è£…" class="sidebar-link heading3">[4],Yarn å®‰è£…</a></li><li class="sidebar-sub-header"><a href="/knowledge/dev-environment/#_5-yarn-é…ç½®" class="sidebar-link heading3">[5],Yarn é…ç½®</a></li></ul></li></ul></li><li><a href="/knowledge/postgresql/" class="sidebar-link"><i class="iconfont icon-compare"></i>ä¸ºä»€ä¹ˆé»˜è®¤ä½¿ç”¨PostgreSQLæ•°æ®åº“ï¼Ÿ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#postgresql-vs-mysql" class="sidebar-link">PostgreSQL VS MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#mysql" class="sidebar-link heading3">MySQL</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#postgresql" class="sidebar-link heading3">PostgreSQL</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#postgresqlç›¸å¯¹äºmysqlçš„ä¼˜åŠ¿" class="sidebar-link">PostgreSQLç›¸å¯¹äºMySQLçš„ä¼˜åŠ¿</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_1-ä¸ä»…ä»…æ˜¯å…³ç³»å‹æ•°æ®åº“" class="sidebar-link heading3">[1],ä¸ä»…ä»…æ˜¯å…³ç³»å‹æ•°æ®åº“</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_2-æ”¯æŒåœ°ç†ä¿¡æ¯å¤„ç†æ‰©å±•" class="sidebar-link heading3">[2],æ”¯æŒåœ°ç†ä¿¡æ¯å¤„ç†æ‰©å±•</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_3-å¯ä»¥å¿«é€Ÿæ„å»ºrest-api" class="sidebar-link heading3">[3],å¯ä»¥å¿«é€Ÿæ„å»ºREST API</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_4-æ”¯æŒæ ‘çŠ¶ç»“æ„" class="sidebar-link heading3">[4],æ”¯æŒæ ‘çŠ¶ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_5-æœ‰æå…¶å¼ºæ‚çš„-sql-ç¼–ç¨‹èƒ½åŠ›" class="sidebar-link heading3">[5],æœ‰æå…¶å¼ºæ‚çš„ SQL ç¼–ç¨‹èƒ½åŠ›</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_6-å¤–éƒ¨æ•°æ®æºæ”¯æŒ" class="sidebar-link heading3">[6],å¤–éƒ¨æ•°æ®æºæ”¯æŒ</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_7-æ²¡æœ‰å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶" class="sidebar-link heading3">[7],æ²¡æœ‰å­—ç¬¦ä¸²é•¿åº¦é™åˆ¶</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_8-æ”¯æŒå›¾ç»“æ„æ•°æ®å­˜å‚¨" class="sidebar-link heading3">[8],æ”¯æŒå›¾ç»“æ„æ•°æ®å­˜å‚¨</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_9-æ”¯æŒçª—å£å‡½æ•°" class="sidebar-link heading3">[9],æ”¯æŒçª—å£å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_10-å¯¹ç´¢å¼•çš„æ”¯æŒæ›´å¼º" class="sidebar-link heading3">[10],å¯¹ç´¢å¼•çš„æ”¯æŒæ›´å¼º</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_11-é›†ç¾¤æ”¯æŒæ›´å¥½" class="sidebar-link heading3">[11],é›†ç¾¤æ”¯æŒæ›´å¥½</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_12-äº‹åŠ¡éš”ç¦»åšçš„æ›´å¥½" class="sidebar-link heading3">[12],äº‹åŠ¡éš”ç¦»åšçš„æ›´å¥½</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_13-å¯¹äºå­—ç¬¦æ”¯æŒæ›´å¥½ä¸€äº›" class="sidebar-link heading3">[13],å¯¹äºå­—ç¬¦æ”¯æŒæ›´å¥½ä¸€äº›</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_14-å¯¹è¡¨è¿æ¥æ”¯æŒè¾ƒå®Œæ•´" class="sidebar-link heading3">[14],å¯¹è¡¨è¿æ¥æ”¯æŒè¾ƒå®Œæ•´</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_15-å­˜å‚¨æ–¹å¼æ”¯æŒæ›´å¤§çš„æ•°æ®é‡" class="sidebar-link heading3">[15],å­˜å‚¨æ–¹å¼æ”¯æŒæ›´å¤§çš„æ•°æ®é‡</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_16-æ—¶é—´ç²¾åº¦æ›´é«˜" class="sidebar-link heading3">[16],æ—¶é—´ç²¾åº¦æ›´é«˜</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_17-ä¼˜åŒ–å™¨çš„åŠŸèƒ½è¾ƒå®Œæ•´" class="sidebar-link heading3">[17],ä¼˜åŒ–å™¨çš„åŠŸèƒ½è¾ƒå®Œæ•´</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_18-åºåˆ—æ”¯æŒæ›´å¥½" class="sidebar-link heading3">[18],åºåˆ—æ”¯æŒæ›´å¥½</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_19-å¯¹å­æŸ¥è¯¢æ”¯æŒæ›´å¥½" class="sidebar-link heading3">[19],å¯¹å­æŸ¥è¯¢æ”¯æŒæ›´å¥½</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_20-å¢åŠ åˆ—æ›´åŠ ç®€å•" class="sidebar-link heading3">[20],å¢åŠ åˆ—æ›´åŠ ç®€å•</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#mysqlç›¸å¯¹äºpostgresqlçš„ä¼˜åŠ¿" class="sidebar-link">MySQLç›¸å¯¹äºPostgreSQLçš„ä¼˜åŠ¿</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_1-mysqlæ¯”postgresqlæ›´æµè¡Œ" class="sidebar-link heading3">[1],MySQLæ¯”PostgreSQLæ›´æµè¡Œ</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_2-å›æ»šå®ç°æ›´ä¼˜" class="sidebar-link heading3">[2],å›æ»šå®ç°æ›´ä¼˜</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_3-åœ¨windowsä¸Šè¿è¡Œæ›´å¯é " class="sidebar-link heading3">[3],åœ¨Windowsä¸Šè¿è¡Œæ›´å¯é </a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_4-çº¿ç¨‹æ¨¡å¼ç›¸æ¯”è¿›ç¨‹æ¨¡å¼çš„ä¼˜åŠ¿" class="sidebar-link heading3">[4],çº¿ç¨‹æ¨¡å¼ç›¸æ¯”è¿›ç¨‹æ¨¡å¼çš„ä¼˜åŠ¿</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_5-æƒé™è®¾ç½®ä¸Šæ›´åŠ å®Œå–„" class="sidebar-link heading3">[5],æƒé™è®¾ç½®ä¸Šæ›´åŠ å®Œå–„</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_6-å­˜å‚¨å¼•æ“æ’ä»¶åŒ–æœºåˆ¶" class="sidebar-link heading3">[6],å­˜å‚¨å¼•æ“æ’ä»¶åŒ–æœºåˆ¶</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_7-é€‚åº”24-7è¿è¡Œ" class="sidebar-link heading3">[7],é€‚åº”24/7è¿è¡Œ</a></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#_8-æ›´åŠ è¯•ç”¨äºç®€å•çš„åœºæ™¯" class="sidebar-link heading3">[8],æ›´åŠ è¯•ç”¨äºç®€å•çš„åœºæ™¯</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/postgresql/#æ€»ç»“" class="sidebar-link">æ€»ç»“</a></li></ul></li><li><a href="/knowledge/spring-data-jpa/" aria-current="page" class="active sidebar-link"><i class="iconfont icon-navigation"></i>Spring Data JPA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#jpa" class="sidebar-link">JPA</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-data-jpa-2" class="sidebar-link heading3">Spring Data Jpa</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#jpa-hibernate-spring-data-jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»" class="sidebar-link heading3">Jpa,Hibernate,Spring Data Jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-data-jpaçš„javaé…ç½®æ–¹æ¡ˆ" class="sidebar-link heading3">Spring Data Jpaçš„javaé…ç½®æ–¹æ¡ˆ</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-bootæ•´åˆspring-data-jpa" class="sidebar-link heading3">Spring Bootæ•´åˆSpring Data Jpa</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-data-jpaçš„ä½¿ç”¨" class="sidebar-link">Spring Data Jpaçš„ä½¿ç”¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-data-jpa-umlç±»å›¾" class="sidebar-link heading3">Spring Data Jpa UMLç±»å›¾</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#ç®€å•çš„rest-crudç¤ºä¾‹" class="sidebar-link heading3">ç®€å•çš„REST CRUDç¤ºä¾‹</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-data-jpaä½¿ç”¨è¯¦è§£" class="sidebar-link">Spring Data Jpaä½¿ç”¨è¯¦è§£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#spring-dataæŸ¥è¯¢æ–¹æ³•" class="sidebar-link heading3">Spring DataæŸ¥è¯¢æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#æŸ¥è¯¢æ–¹æ³•" class="sidebar-link heading3">æŸ¥è¯¢æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#å¤šè¡¨æŸ¥è¯¢" class="sidebar-link heading3">å¤šè¡¨æŸ¥è¯¢</a></li></ul></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#å®¡è®¡auditing" class="sidebar-link">å®¡è®¡Auditing</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#å®ç°auditorawareæ¥å£" class="sidebar-link heading3">å®ç°AuditorAwareæ¥å£</a></li><li class="sidebar-sub-header"><a href="/knowledge/spring-data-jpa/#å¯ç”¨jpaå®¡è®¡åŠŸèƒ½" class="sidebar-link heading3">å¯ç”¨Jpaå®¡è®¡åŠŸèƒ½</a></li></ul></li></ul></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb"><ol vocab="https://schema.org/" typeof="BreadcrumbList"><li property="itemListElement" typeof="ListItem"><a href="/knowledge/" property="item" typeof="WebPage" class="router-link-active"><i class="iconfont icon-leaf"></i> <span property="name">äº†è§£åŸºç¡€çŸ¥è¯†</span></a> <meta property="position" content="1"></li><li property="itemListElement" typeof="ListItem" class="is-active"><a href="/knowledge/spring-data-jpa/" aria-current="page" property="item" typeof="WebPage" class="router-link-exact-active router-link-active"><i class="iconfont icon-navigation"></i> <span property="name">Spring Data JPA</span></a> <meta property="position" content="2"></li></ol></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><i class="iconfont icon-navigation"></i> <span property="headline">Spring Data JPA</span></h1> <div class="page-info"><!----> <span aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span property="author">ç åŒ å›</span></span><!----><span aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" class="time-info"><svg viewBox="0 0 1030 1024" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 0 1-33.473-33.473V143.657H180.6A134.314 134.314 0 0 0 46.66 277.595v535.756A134.314 134.314 0 0 0 180.6 947.289h669.74a134.36 134.36 0 0 0 133.94-133.938V277.595a134.314 134.314 0 0 0-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 0 1-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 0 1-33.472 33.473z" fill="currentColor"></path></svg> <span property="datePublished">2021-10-28</span></span><!----><!----><span aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" class="reading-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon timer-icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z" fill="currentColor"></path></svg> <span>å¤§çº¦ 22 åˆ†é’Ÿ</span> <meta property="timeRequired" content="PT22M"></span></div> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/knowledge/spring-data-jpa/#jpa" class="anchor-link heading2"><div>JPA</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-data-jpa-2" class="anchor-link heading3"><div>Spring Data Jpa</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#jpa-hibernate-spring-data-jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»" class="anchor-link heading3"><div>Jpa,Hibernate,Spring Data Jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-data-jpaçš„javaé…ç½®æ–¹æ¡ˆ" class="anchor-link heading3"><div>Spring Data Jpaçš„javaé…ç½®æ–¹æ¡ˆ</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-bootæ•´åˆspring-data-jpa" class="anchor-link heading3"><div>Spring Bootæ•´åˆSpring Data Jpa</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-data-jpaçš„ä½¿ç”¨" class="anchor-link heading2"><div>Spring Data Jpaçš„ä½¿ç”¨</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-data-jpa-umlç±»å›¾" class="anchor-link heading3"><div>Spring Data Jpa UMLç±»å›¾</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#ç®€å•çš„rest-crudç¤ºä¾‹" class="anchor-link heading3"><div>ç®€å•çš„REST CRUDç¤ºä¾‹</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-data-jpaä½¿ç”¨è¯¦è§£" class="anchor-link heading2"><div>Spring Data Jpaä½¿ç”¨è¯¦è§£</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#spring-dataæŸ¥è¯¢æ–¹æ³•" class="anchor-link heading3"><div>Spring DataæŸ¥è¯¢æ–¹æ³•</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#æŸ¥è¯¢æ–¹æ³•" class="anchor-link heading3"><div>æŸ¥è¯¢æ–¹æ³•</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#å¤šè¡¨æŸ¥è¯¢" class="anchor-link heading3"><div>å¤šè¡¨æŸ¥è¯¢</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#å®¡è®¡auditing" class="anchor-link heading2"><div>å®¡è®¡Auditing</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#å®ç°auditorawareæ¥å£" class="anchor-link heading3"><div>å®ç°AuditorAwareæ¥å£</div></a></li><li class="anchor"><a href="/knowledge/spring-data-jpa/#å¯ç”¨jpaå®¡è®¡åŠŸèƒ½" class="anchor-link heading3"><div>å¯ç”¨Jpaå®¡è®¡åŠŸèƒ½</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="spring-data-jpa"><a href="#spring-data-jpa" class="header-anchor">#</a> Spring Data JPA</h1> <h2 id="jpa"><a href="#jpa" class="header-anchor">#</a> JPA</h2> <p><code>JPA</code>(<code>Java Persistence API</code>)æ„å³JavaæŒä¹…åŒ–APIï¼Œæ˜¯Sunå®˜æ–¹åœ¨JDK5.0åæå‡ºçš„JavaæŒä¹…åŒ–è§„èŒƒï¼ˆJSR 338ï¼Œè¿™äº›æ¥å£æ‰€åœ¨åŒ…ä¸º<code>javax.persistence</code>ï¼Œè¯¦ç»†å†…å®¹å¯å‚è€ƒ<a href="https://github.com/javaee/jpa-spec" target="_blank" rel="noopener noreferrer">https://github.com/javaee/jpa-spec<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼‰</p> <p>JPAçš„å‡ºç°ä¸»è¦æ˜¯ä¸ºäº†ç®€åŒ–æŒä¹…å±‚å¼€å‘ä»¥åŠæ•´åˆ<code>ORM</code>æŠ€æœ¯ï¼Œç»“æŸ <code>Hibernate</code>,<code>TopLink</code>,<code>JDO</code>ç­‰<code>ORM</code>æ¡†æ¶å„è‡ªä¸ºè¥çš„å±€é¢ã€‚<code>JPA</code>æ˜¯åœ¨å¸æ”¶ç°æœ‰<code>ORM</code>æ¡†æ¶çš„åŸºç¡€ä¸Šå‘å±•è€Œæ¥ï¼Œæ˜“äºä½¿ç”¨ï¼Œä¼¸ç¼©æ€§å¼ºã€‚æ€»çš„æ¥è¯´ï¼ŒJPAåŒ…æ‹¬ä»¥ä¸‹3æ–¹é¢çš„æŠ€æœ¯ï¼š</p> <ul><li><strong>ORMæ˜ å°„å…ƒæ•°æ®ï¼š</strong> æ”¯æŒXMLå’Œæ³¨è§£ä¸¤ç§å…ƒæ•°æ®çš„å½¢å¼ï¼Œå…ƒæ•°æ®æè¿°å¯¹è±¡å’Œè¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»</li> <li><strong>APIï¼š</strong>  æ“ä½œå®ä½“å¯¹è±¡æ¥æ‰§è¡ŒCRUDæ“ä½œ</li> <li><strong>æŸ¥è¯¢è¯­è¨€ï¼š</strong>  é€šè¿‡é¢å‘å¯¹è±¡è€Œéé¢å‘æ•°æ®åº“çš„æŸ¥è¯¢è¯­è¨€ï¼ˆJPQLï¼‰æŸ¥è¯¢æ•°æ®ï¼Œé¿å…ç¨‹åºçš„SQLè¯­å¥ç´§å¯†è€¦åˆ</li></ul> <p><img src="/images/jpa/architecture.png" alt="JPAæ¶æ„"></p> <h3 id="spring-data-jpa-2"><a href="#spring-data-jpa-2" class="header-anchor">#</a> Spring Data Jpa</h3> <p>Springå®˜æ–¹çš„è§£é‡Š<a href="https://spring.io/projects/spring-data-jpa#overview" target="_blank" rel="noopener noreferrer">https://spring.io/projects/spring-data-jpa#overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/images/jpa/spring-data-jpa.png" alt="Spring Data Jpaå®˜æ–¹è§£é‡Š"></p> <p><code>Spring Data JPA</code> æ˜¯ <code>Spring Data</code> å®¶æ—çš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥è½»æ¾å®ç°åŸºäº <code>JPA</code> çš„å­˜å‚¨åº“ã€‚ æ­¤æ¨¡å—å¤„ç†å¯¹åŸºäº <code>JPA</code> çš„æ•°æ®è®¿é—®å±‚çš„å¢å¼ºæ”¯æŒã€‚ å®ƒä½¿æ„å»ºä½¿ç”¨æ•°æ®è®¿é—®æŠ€æœ¯çš„Springé©±åŠ¨åº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</p> <p>åœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ï¼Œå®ç°åº”ç”¨ç¨‹åºçš„æ•°æ®è®¿é—®å±‚ä¸€ç›´å¾ˆéº»çƒ¦ã€‚ å¿…é¡»ç¼–å†™å¤ªå¤šæ ·æ¿ä»£ç æ¥æ‰§è¡Œç®€å•æŸ¥è¯¢ä»¥åŠæ‰§è¡Œåˆ†é¡µå’Œå®¡è®¡ã€‚ <code>Spring Data JPA</code> æ—¨åœ¨é€šè¿‡å‡å°‘å®é™…éœ€è¦çš„å·¥ä½œé‡æ¥æ˜¾è‘—æ”¹å–„æ•°æ®è®¿é—®å±‚çš„å®ç°ã€‚ ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæ‚¨ç¼–å†™repositoryæ¥å£ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æŸ¥æ‰¾å™¨æ–¹æ³•ï¼ŒSpringå°†è‡ªåŠ¨æä¾›å®ç°ã€‚</p> <p><img src="/images/jpa/spring-data.png" alt="Spring Dataç”Ÿæ€"></p> <h3 id="jpa-hibernate-spring-data-jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»"><a href="#jpa-hibernate-spring-data-jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»" class="header-anchor">#</a> Jpa,Hibernate,Spring Data Jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»</h3> <p>è¿™ä¸ªé—®é¢˜å¯å‚è€ƒ<a href="https://stackoverflow.com/questions/16148188/spring-data-jpa-versus-jpa-whats-the-difference%E5%8F%8Ahttps://blog.csdn.net/u014421556/article/details/52635000" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/questions/16148188/spring-data-jpa-versus-jpa-whats-the-differenceåŠhttps://blog.csdn.net/u014421556/article/details/52635000<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>æ€»çš„æ¥è¯´<code>JPA</code>æ˜¯<code>ORM</code>è§„èŒƒï¼Œ<code>Hibernate</code>,<code>TopLink</code> ç­‰æ˜¯ <code>JPA</code> è§„èŒƒçš„å…·ä½“å®ç°ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¼€å‘è€…å¯ä»¥é¢å‘ <code>JPA</code> è§„èŒƒè¿›è¡ŒæŒä¹…å±‚çš„å¼€å‘ï¼Œè€Œåº•å±‚çš„å®ç°åˆ™æ˜¯å¯ä»¥åˆ‡æ¢çš„ã€‚<code>Spring Data Jpa</code> åˆ™æ˜¯åœ¨ <code>JPA</code> ä¹‹ä¸Šæ·»åŠ å¦ä¸€å±‚æŠ½è±¡ï¼ˆ<code>Repository</code>å±‚çš„å®ç°ï¼‰ï¼Œæå¤§åœ°ç®€åŒ–æŒä¹…å±‚å¼€å‘åŠ <code>ORM</code> æ¡†æ¶åˆ‡æ¢çš„æˆæœ¬ã€‚</p> <p><img src="/images/jpa/three-relationship.png" alt="Jpa,Hibernate,Spring Data Jpaä¸‰è€…ä¹‹é—´çš„å…³ç³»"></p> <h3 id="spring-data-jpaçš„javaé…ç½®æ–¹æ¡ˆ"><a href="#spring-data-jpaçš„javaé…ç½®æ–¹æ¡ˆ" class="header-anchor">#</a> Spring Data Jpaçš„javaé…ç½®æ–¹æ¡ˆ</h3> <p>åœ¨ <code>Spring Boot</code> æ²¡å‡ºæ¥ä¹‹å‰å¦‚æœè¦é‡‡ç”¨ <code>Java Configuration</code> æ¥é…ç½® <code>Spring Data Jpa</code> ä½ éœ€è¦é…ç½®å¦‚ä¸‹çš„Bean
å‚è€ƒè‡ªSpring In ActionåŠ<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.java-config" target="_blank" rel="noopener noreferrer">Spring Data Jpaå®˜æ–¹æ–‡æ¡£5.1.2. Annotation-based Configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">EnableJpaRepositories</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span></span><span class="token class-name">JpaTransactionManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span></span><span class="token class-name">JpaVendorAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span></span><span class="token class-name">LocalContainerEntityManagerFactoryBean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>vendor<span class="token punctuation">.</span></span><span class="token class-name">Database</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>orm<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>vendor<span class="token punctuation">.</span></span><span class="token class-name">HibernateJpaVendorAdapter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span></span><span class="token class-name">PlatformTransactionManager</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableTransactionManagement</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token class-name">EntityManagerFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">DataSource</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * æ³¨æ„ï¼šspring-data-jpa2.xç‰ˆæœ¬éœ€è¦springç‰ˆæœ¬ä¸º5.x
 * å¦åˆ™ä¼šæŠ¥Initialization of bean failed; nested exception is java.lang.AbstractMethodErroré”™è¯¯
 * å‚è€ƒï¼šhttps://stackoverflow.com/questions/47558017/error-starting-a-spring-application-initialization-of-bean-failed-nested-excep
 * æ­é…æ–¹æ¡ˆï¼šspring4+spring-data-jpa1.xæˆ–spring5+spring-data-jpa2.x
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token comment">// å€ŸåŠ©spring dataå®ç°è‡ªåŠ¨åŒ–çš„jpa repositoryï¼Œåªéœ€ç¼–å†™æ¥å£æ— éœ€ç¼–å†™å®ç°ç±»</span>
<span class="token comment">// ç›¸å½“äºxmlé…ç½®çš„&lt;jpa:repositories base-package=&quot;com.example.repository&quot; /&gt;</span>
<span class="token comment">// repositoryImplementationPostfixé»˜è®¤å°±æ˜¯Impl</span>
<span class="token comment">// entityManagerFactoryRefé»˜è®¤å°±æ˜¯entityManagerFactory</span>
<span class="token comment">// transactionManagerRefé»˜è®¤å°±æ˜¯transactionManager</span>
<span class="token annotation punctuation">@EnableJpaRepositories</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;com.example.repository&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        repositoryImplementationPostfix <span class="token operator">=</span> <span class="token string">&quot;Impl&quot;</span><span class="token punctuation">,</span>
        entityManagerFactoryRef <span class="token operator">=</span> <span class="token string">&quot;entityManagerFactory&quot;</span><span class="token punctuation">,</span>
        transactionManagerRef <span class="token operator">=</span> <span class="token string">&quot;transactionManager&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableTransactionManagement</span>    <span class="token comment">// å¯ç”¨äº‹åŠ¡ç®¡ç†å™¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringDataJpaConfig</span> <span class="token punctuation">{</span>

    <span class="token comment">// é…ç½®jpaå‚å•†é€‚é…å™¨ï¼ˆå‚è§springå®æˆ˜p320ï¼‰</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JpaVendorAdapter</span> <span class="token function">jpaVendorAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">HibernateJpaVendorAdapter</span> jpaVendorAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HibernateJpaVendorAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æ•°æ®åº“ç±»å‹ï¼ˆå¯ä½¿ç”¨org.springframework.orm.jpa.vendoråŒ…ä¸‹çš„Databaseæšä¸¾ç±»ï¼‰</span>
        jpaVendorAdapter<span class="token punctuation">.</span><span class="token function">setDatabase</span><span class="token punctuation">(</span><span class="token class-name">Database</span><span class="token punctuation">.</span>MYSQL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æ‰“å°sqlè¯­å¥</span>
        jpaVendorAdapter<span class="token punctuation">.</span><span class="token function">setShowSql</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®ä¸ç”Ÿæˆddlè¯­å¥</span>
        jpaVendorAdapter<span class="token punctuation">.</span><span class="token function">setGenerateDdl</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®hibernateæ–¹è¨€</span>
        jpaVendorAdapter<span class="token punctuation">.</span><span class="token function">setDatabasePlatform</span><span class="token punctuation">(</span><span class="token string">&quot;org.hibernate.dialect.MySQL5Dialect&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jpaVendorAdapter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> <span class="token function">entityManagerFactory</span><span class="token punctuation">(</span>
            <span class="token class-name">DataSource</span> dataSource<span class="token punctuation">,</span> <span class="token class-name">JpaVendorAdapter</span> jpaVendorAdapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LocalContainerEntityManagerFactoryBean</span> emfb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalContainerEntityManagerFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ³¨å…¥æ•°æ®æº</span>
        emfb<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ³¨å…¥jpaå‚å•†é€‚é…å™¨</span>
        emfb<span class="token punctuation">.</span><span class="token function">setJpaVendorAdapter</span><span class="token punctuation">(</span>jpaVendorAdapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½®æ‰«æåŸºæœ¬åŒ…</span>
        emfb<span class="token punctuation">.</span><span class="token function">setPackagesToScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.entity&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> emfb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// é…ç½®jpaäº‹åŠ¡ç®¡ç†å™¨</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">PlatformTransactionManager</span> <span class="token function">transactionManager</span><span class="token punctuation">(</span><span class="token class-name">EntityManagerFactory</span> emf<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">JpaTransactionManager</span> transactionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JpaTransactionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚</span>
        transactionManager<span class="token punctuation">.</span><span class="token function">setEntityManagerFactory</span><span class="token punctuation">(</span>emf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> transactionManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>å¯ç”¨webæ”¯æŒè¿˜éœ€è¦åœ¨ <code>Spring MVC</code> é…ç½®ç±»ä¸Šæ·»åŠ  <code>@EnableSpringDataWebSupport</code> æ³¨è§£</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;cn.fulgens.controller&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableWebMvc</span>   <span class="token comment">// å¯ç”¨spring mvc</span>
<span class="token annotation punctuation">@EnableSpringDataWebSupport</span>     <span class="token comment">// å¯ç”¨springmvcå¯¹spring dataçš„æ”¯æŒ</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurerAdapter</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="spring-bootæ•´åˆspring-data-jpa"><a href="#spring-bootæ•´åˆspring-data-jpa" class="header-anchor">#</a> Spring Bootæ•´åˆSpring Data Jpa</h3> <h4 id="å¯¼å…¥ä¾èµ–"><a href="#å¯¼å…¥ä¾èµ–" class="header-anchor">#</a> å¯¼å…¥ä¾èµ–</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="ç›¸å…³é…ç½®"><a href="#ç›¸å…³é…ç½®" class="header-anchor">#</a> ç›¸å…³é…ç½®</h4> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> mysql123
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> MySQL
    <span class="token key atrule">database-platform</span><span class="token punctuation">:</span> org.hibernate.dialect.MySQL5InnoDBDialect
    <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
      <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">ddl-auto</p> <ul><li>createï¼šæ¯æ¬¡è¿è¡Œç¨‹åºæ—¶ï¼Œéƒ½ä¼šé‡æ–°åˆ›å»ºè¡¨ï¼Œæ•…è€Œæ•°æ®ä¼šä¸¢å¤±</li> <li>create-dropï¼šæ¯æ¬¡è¿è¡Œç¨‹åºæ—¶ä¼šå…ˆåˆ›å»ºè¡¨ç»“æ„ï¼Œç„¶åå¾…ç¨‹åºç»“æŸæ—¶æ¸…ç©ºè¡¨</li> <li>upadteï¼šæ¯æ¬¡è¿è¡Œç¨‹åºï¼Œæ²¡æœ‰è¡¨æ—¶ä¼šåˆ›å»ºè¡¨ï¼Œå¦‚æœå¯¹è±¡å‘ç”Ÿæ”¹å˜ä¼šæ›´æ–°è¡¨ç»“æ„ï¼ŒåŸæœ‰æ•°æ®ä¸ä¼šæ¸…ç©ºï¼Œåªä¼šæ›´æ–°ï¼ˆæ¨èä½¿ç”¨ï¼‰</li> <li>validateï¼šè¿è¡Œç¨‹åºä¼šæ ¡éªŒæ•°æ®ä¸æ•°æ®åº“çš„å­—æ®µç±»å‹æ˜¯å¦ç›¸åŒï¼Œå­—æ®µä¸åŒä¼šæŠ¥é”™</li> <li>none: ç¦ç”¨DDLå¤„ç†</li></ul></div> <h2 id="spring-data-jpaçš„ä½¿ç”¨"><a href="#spring-data-jpaçš„ä½¿ç”¨" class="header-anchor">#</a> Spring Data Jpaçš„ä½¿ç”¨</h2> <h3 id="spring-data-jpa-umlç±»å›¾"><a href="#spring-data-jpa-umlç±»å›¾" class="header-anchor">#</a> Spring Data Jpa UMLç±»å›¾</h3> <p><img src="/images/jpa/spring-data-jpa-uml.png" alt="Spring Data JPA UML"></p> <h3 id="ç®€å•çš„rest-crudç¤ºä¾‹"><a href="#ç®€å•çš„rest-crudç¤ºä¾‹" class="header-anchor">#</a> ç®€å•çš„REST CRUDç¤ºä¾‹</h3> <p><strong>å®ä½“ç±»</strong></p> <p><code>/src/main/java/com/example/springbootjpa/entity/User</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">ä¸»é”®é‡‡ç”¨UUIDç­–ç•¥</p> <p><code>@GenericGenerator</code> æ˜¯ <code>Hibernate</code> æä¾›çš„ä¸»é”®ç”Ÿæˆç­–ç•¥æ³¨è§£ï¼Œæ³¨æ„ä¸‹é¢çš„ <code>@GeneratedValue</code>ï¼ˆJPAæ³¨è§£ï¼‰ä½¿ç”¨<code>generator = &quot;idGenerator&quot;</code>å¼•ç”¨äº†ä¸Šé¢çš„<code>name = &quot;idGenerator&quot;</code>ä¸»é”®ç”Ÿæˆç­–ç•¥</p></div> <p>ä¸€èˆ¬ç®€å•çš„Demoç¤ºä¾‹ä¸­åªä¼šä½¿ç”¨<code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code>è¿™ç§ä¸»é”®è‡ªå¢çš„ç­–ç•¥ï¼Œè€Œå®é™…æ•°æ®åº“ä¸­è¡¨å­—æ®µä¸»é”®ç±»å‹å¾ˆå°‘æ˜¯<code>int</code>å‹çš„</p> <div class="custom-block tip"><p class="custom-block-title">JPAè‡ªå¸¦çš„å‡ ç§ä¸»é”®ç”Ÿæˆç­–ç•¥</p> <ul><li>TABLEï¼š ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„æ•°æ®åº“è¡¨æ ¼æ¥ä¿å­˜ä¸»é”®</li> <li>SEQUENCEï¼š æ ¹æ®åº•å±‚æ•°æ®åº“çš„åºåˆ—æ¥ç”Ÿæˆä¸»é”®ï¼Œæ¡ä»¶æ˜¯æ•°æ®åº“æ”¯æŒåºåˆ—ã€‚è¿™ä¸ªå€¼è¦ä¸generatorä¸€èµ·ä½¿ç”¨ï¼Œgenerator æŒ‡å®šç”Ÿæˆä¸»é”®ä½¿ç”¨çš„ç”Ÿæˆå™¨ï¼ˆå¯èƒ½æ˜¯orcaleä¸­è‡ªå·±ç¼–å†™çš„åºåˆ—ï¼‰</li> <li>IDENTITYï¼š ä¸»é”®ç”±æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆï¼ˆä¸»è¦æ˜¯æ”¯æŒè‡ªåŠ¨å¢é•¿çš„æ•°æ®åº“ï¼Œå¦‚mysqlï¼‰</li> <li>AUTOï¼š ä¸»é”®ç”±ç¨‹åºæ§åˆ¶ï¼Œä¹Ÿæ˜¯GenerationTypeçš„é»˜è®¤å€¼</li></ul></div> <p><strong>Daoå±‚</strong></p> <p><code>/src/main/java/com/example/springbootjpa/repository/UserRepository</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaRepository</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>Controllerå±‚</strong></p> <blockquote><p>è¿™é‡Œç®€å•èµ·è§çœç•¥Serviceå±‚</p></blockquote> <p><code>/src/main/java/com/example/springbootjpa/controller/UserController</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">UserRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Page</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">PageRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">Pageable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/users&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">saveUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@DeleteMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userRepository<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">saveAndFlush</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> optional<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/list&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">pageQuery</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pageNum&quot;</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> pageNum<span class="token punctuation">,</span>
                                <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>pageNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h2 id="spring-data-jpaä½¿ç”¨è¯¦è§£"><a href="#spring-data-jpaä½¿ç”¨è¯¦è§£" class="header-anchor">#</a> Spring Data Jpaä½¿ç”¨è¯¦è§£</h2> <h3 id="spring-dataæŸ¥è¯¢æ–¹æ³•"><a href="#spring-dataæŸ¥è¯¢æ–¹æ³•" class="header-anchor">#</a> Spring DataæŸ¥è¯¢æ–¹æ³•</h3> <p>ä½¿ç”¨Spring Dataåˆ›å»ºæŸ¥è¯¢åªéœ€å››æ­¥ï¼š</p> <ol><li>å£°æ˜ä¸€ä¸ªæ¥å£ç»§æ‰¿è‡ªRepositoryæˆ–Repositoyçš„ä¸€ä¸ªå­æ¥å£ï¼Œå¯¹äºSpring Data Jpaé€šå¸¸æ˜¯JpaRepositoryï¼Œå¦‚ï¼š</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">PersonRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span> â€¦ <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li>åœ¨æ¥å£ä¸­å£°æ˜æŸ¥è¯¢æ–¹æ³•ï¼Œå¦‚ï¼š</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">interface</span> <span class="token class-name">PersonRepository</span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token class-name">String</span> lastname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>ä½¿ç”¨ <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances.java-config" target="_blank" rel="noopener noreferrer">JavaConfig<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> æˆ– <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#repositories.create-instances" target="_blank" rel="noopener noreferrer">XML configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>é…ç½®Springï¼Œè®© Spring ä¸ºå£°æ˜çš„æ¥å£åˆ›å»ºä»£ç†å¯¹è±¡
3.1 JavaConfigå‚è§ä¸Šæ–‡
3.2 ä½¿ç”¨Xmlé…ç½®ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·ä½¿ç”¨jpaå‘½åç©ºé—´è¿›è¡Œé…ç½®ï¼š</li></ol> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xmlns:</span>jpa</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/data/jpa<span class="token punctuation">&quot;</span></span>
   <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
     http://www.springframework.org/schema/beans/spring-beans.xsd
     http://www.springframework.org/schema/data/jpa
     http://www.springframework.org/schema/data/jpa/spring-jpa.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">jpa:</span>repositories</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.acme.repositories<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>å¯¹äºä¸åŒçš„ <code>Spring Data</code> å­é¡¹ç›®Springæä¾›äº†ä¸åŒçš„xmlå‘½åç©ºé—´ï¼Œå¦‚å¯¹äº <code>Spring Data MongoDB</code> å¯ä»¥å°†ä¸Šé¢çš„jpaæ”¹ä¸ºmongodbã€‚å½“ç„¶ï¼Œä½¿ç”¨ <code>Spring Boot</code> è¿™ä¸€æ­¥åŸºæœ¬å¯ä»¥çœç•¥ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨<code>application.properties</code>æˆ–<code>application.yml</code>æ–‡ä»¶ä¸­é…ç½®å‡ ä¸ªå±æ€§å³å¯</p></blockquote> <ol start="4"><li>æ³¨å…¥Repositoryå®ä¾‹å¹¶ä½¿ç”¨ï¼Œå¦‚ï¼š</li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">SomeClient</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PersonRepository</span> repository<span class="token punctuation">;</span>

  <span class="token class-name">SomeClient</span><span class="token punctuation">(</span><span class="token class-name">PersonRepository</span> repository<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>repository <span class="token operator">=</span> repository<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> persons <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByLastname</span><span class="token punctuation">(</span><span class="token string">&quot;Matthews&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="å®šä¹‰repositoryæ¥å£"><a href="#å®šä¹‰repositoryæ¥å£" class="header-anchor">#</a> å®šä¹‰Repositoryæ¥å£</h4> <p><strong>é€‰æ‹©æ€§æš´éœ²CRUDæ–¹æ³•</strong></p> <p>ä¸€ç§æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ª<code>BaseRepository</code>æ¥å£ç»§æ‰¿<code>Repository</code>æ¥å£ï¼Œå¹¶ä»<code>CrudRepository</code>ä¸­copyä½ æƒ³æš´éœ²çš„CRUDæ–¹æ³•</p> <p><code>src/main/java/com/example/springbootjpa/repository/MyBaseRepository</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">NoRepositoryBean</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * è‡ªå®šä¹‰Repositoryï¼Œé€‰æ‹©æ€§æš´éœ²CRUDæ–¹æ³•
 * @param &lt;T&gt;
 * @param &lt;ID&gt;
 */</span>
<span class="token annotation punctuation">@NoRepositoryBean</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MyBaseRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Repository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> ID<span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">ID</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">S</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">S</span> entity<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>æ³¨æ„ï¼š<code>MyBaseRepository</code>ä¸Šé¢åŠ äº† <code>@NoRepositoryBean</code> æ³¨è§£</p></blockquote> <p><code>src/main/java/com/example/springbootjpa/repository/UserRepository2</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository2</span> <span class="token keyword">extends</span> <span class="token class-name">MyBaseRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="repositoryæ–¹æ³•çš„nullå€¼å¤„ç†"><a href="#repositoryæ–¹æ³•çš„nullå€¼å¤„ç†" class="header-anchor">#</a> Repositoryæ–¹æ³•çš„Nullå€¼å¤„ç†</h4> <p>ä» <code>Spring Data2.0</code> å¼€å§‹å¯¹äºè¿”å›å•ä¸ªèšåˆå®ä¾‹çš„CRUDæ–¹æ³•å¯ä»¥ä½¿ç”¨java8 Optionalæ¥å£ä½œä¸ºæ–¹æ³•è¿”å›å€¼æ¥è¡¨æ˜å¯èƒ½å­˜åœ¨çš„ç¼ºçœå€¼ï¼Œå…¸å‹ç¤ºä¾‹ä¸º <code>CrudRepository</code> çš„ <code>findById</code> æ–¹æ³•</p> <p>å¦å¤–Springä¹Ÿæä¾›äº†å‡ ä¸ªæ³¨è§£æ¥å¤„ç†Nullå€¼</p> <ul><li>@NonNullApi: åœ¨åŒ…çº§åˆ«ä½¿ç”¨æ¥å£°æ˜å‚æ•°å’Œè¿”å›å€¼ä¸èƒ½ä¸ºNull</li> <li>@NonNull: åœ¨å‚æ•°æˆ–è¿”å›å€¼ä¸Šä½¿ç”¨ï¼Œå½“å®ƒä»¬ä¸èƒ½ä¸ºNullæ—¶ï¼ˆå¦‚æœåœ¨åŒ…çº§åˆ«ä¸Šä½¿ç”¨äº†@NonNullApiæ³¨è§£åˆ™æ²¡æœ‰å¿…è¦å†ä½¿ç”¨@NonNullæ³¨è§£äº†ï¼‰</li> <li>@Nullable: åœ¨å‚æ•°æˆ–è¿”å›å€¼ä¸Šä½¿ç”¨ï¼Œå½“å®ƒä»¬å¯ä»¥ä¸ºNullæ—¶</li></ul> <h3 id="æŸ¥è¯¢æ–¹æ³•"><a href="#æŸ¥è¯¢æ–¹æ³•" class="header-anchor">#</a> æŸ¥è¯¢æ–¹æ³•</h3> <h4 id="æŸ¥è¯¢åˆ›å»ºquery-creation"><a href="#æŸ¥è¯¢åˆ›å»ºquery-creation" class="header-anchor">#</a> æŸ¥è¯¢åˆ›å»ºQuery Creation</h4> <p><code>Spring Data Jpa</code> é€šè¿‡è§£ææ–¹æ³•ååˆ›å»ºæŸ¥è¯¢ï¼Œæ¡†æ¶åœ¨è¿›è¡Œæ–¹æ³•åè§£ææ—¶ï¼Œä¼šå…ˆæŠŠæ–¹æ³•åå¤šä½™çš„å‰ç¼€<code>findâ€¦By</code>, <code>readâ€¦By</code>, <code>queryâ€¦By</code>, <code>countâ€¦By</code>ä»¥åŠ <code>getâ€¦By</code> æˆªå–æ‰ï¼Œç„¶åå¯¹å‰©ä¸‹éƒ¨åˆ†è¿›è¡Œè§£æï¼Œç¬¬ä¸€ä¸ªByä¼šè¢«ç”¨ä½œåˆ†éš”ç¬¦æ¥æŒ‡ç¤ºå®é™…æŸ¥è¯¢æ¡ä»¶çš„å¼€å§‹ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨å®ä½“å±æ€§ä¸Šå®šä¹‰æ¡ä»¶ï¼Œå¹¶å°†å®ƒä»¬ä¸Andå’ŒOrè¿æ¥èµ·æ¥ï¼Œä»è€Œåˆ›å»ºå¤§é‡æŸ¥è¯¢ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">User</span> <span class="token function">findByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameIgnoreCase</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">User</span> <span class="token function">findByUsernameAndPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">User</span> <span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByEmailLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByIdIn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByIdInOrderByUsername</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">deleteByIdIn</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Long</span> <span class="token function">countByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>æ”¯æŒçš„å…³é”®å­—,ç¤ºä¾‹åŠ <code>JPQL</code> ç‰‡æ®µå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p> <p>| Keyword | Sample | JPQL snippet |
| ------- | ------ | ------------ ||
| <code>Distinct</code>           | <code>findDistinctByLastnameAndFirstname</code>                      | <code>select distinct â€¦â€‹ where x.lastname = ?1 and x.firstname = ?2</code>  |
| <code>And</code>              | <code>findByLastnameAndFirstname</code>                              | <code>â€¦ where x.lastname = ?1 and x.firstname = ?2</code>                   |
| <code>Or</code>                 | <code>findByLastnameOrFirstname</code>                               | <code>â€¦ where x.lastname = ?1 or x.firstname = ?2</code>                    |
| <code>Is, Equals</code>         | <code>findByFirstname</code>,<code>findByFirstnameIs</code>,<code>findByFirstnameEquals</code> | <code>â€¦ where x.firstname = ?</code>1                                       |
| <code>Between</code>            | <code>findByStartDateBetween</code>                                  | <code>â€¦ where x.startDate between ?1 and ?2</code>                          |
| <code>LessThan</code>           | <code>findByAgeLessThan</code>                                       | <code>â€¦ where x.age &lt; ?1</code>                                             |
| <code>LessThanEqual</code>      | <code>findByAgeLessThanEqual</code>                                  | <code>â€¦ where x.age &lt;= ?1</code>                                            |
| <code>GreaterThan</code>        | <code>findByAgeGreaterThan</code>                                    | <code>â€¦ where x.age &gt; ?1</code>                                             |
| <code>GreaterThanEqual</code>   | <code>findByAgeGreaterThanEqual</code>                               | <code>â€¦ where x.age &gt;= ?1</code>                                           |
| <code>After</code>              | <code>findByStartDateAfter</code>                                    | <code>â€¦ where x.startDate &gt; ?1</code>                                       |
| <code>Before</code>             | <code>findByStartDateBefore</code>                                   | <code>â€¦ where x.startDate &lt; ?1</code>                                       |
| <code>IsNull, Null</code>       | <code>findByAge(Is)Null</code>                                       | <code>â€¦ where x.age is null</code>                                          |
| <code>IsNotNull, NotNull</code> | <code>findByAge(Is)NotNull</code>                                    | <code>â€¦ where x.age not null</code>                                         |
| <code>Like</code>               | <code>findByFirstnameLike</code>                                     | <code>â€¦ where x.firstname like ?1</code>                                    |
| <code>NotLike</code>            | <code>findByFirstnameNotLike</code>                                  | <code>â€¦ where x.firstname not like ?1</code>                                |
| <code>StartingWith</code>       | <code>findByFirstnameStartingWith</code>                             |<code>â€¦ where x.firstname like ?1 (parameter bound with appended %)</code>  |
| <code>EndingWith</code>         | <code>findByFirstnameEndingWith</code>                               | <code>â€¦ where x.firstname like ?1 (parameter bound with prepended %)</code> |
| <code>Containing</code>         | <code>findByFirstnameContaining</code>                               | <code>â€¦ where x.firstname like ?1 (parameter bound wrapped in %)</code>     |
| <code>OrderBy</code>           | <code>findByAgeOrderByLastnameDesc</code>                            | <code>â€¦ where x.age = ?1 order by x.lastname desc</code>                    |
| <code>Not</code>                | <code>findByLastnameNot</code>                                       | <code>â€¦ where x.lastname &lt;&gt; ?1</code>                                       |
| <code>In</code>                 | <code>findByAgeIn(Collection&lt;Age&gt; ages)</code>                       | <code>â€¦ where x.age in ?1</code>                                            |
| <code>NotIn</code>              | <code>findByAgeNotIn(Collection&lt;Age&gt; ages)</code>                    | <code>â€¦ where x.age not in ?1</code>                                        |
| <code>True</code>               | <code>findByActiveTrue()</code>                                     | <code>â€¦ where x.active = true</code>                                        |
| <code>False</code>              | <code>findByActiveFalse()</code>                                     | <code>â€¦ where x.active = false</code>                                       |
| <code>IgnoreCase</code>         | <code>findByFirstnameIgnoreCase</code>                               | <code>â€¦ where UPPER(x.firstname) = UPPER(?1)</code>                         |</p> <p>å…·ä½“ <code>Spring Data Jpa</code> å¯¹æ–¹æ³•åçš„è§£æè§„åˆ™å¯å‚çœ‹<a href="https://docs.spring.io/spring-data/jpa/docs/2.5.4/reference/html/#reference" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="é™åˆ¶æŸ¥è¯¢ç»“æœ"><a href="#é™åˆ¶æŸ¥è¯¢ç»“æœ" class="header-anchor">#</a> é™åˆ¶æŸ¥è¯¢ç»“æœ</h4> <p><code>Spring Data Jpa</code> æ”¯æŒä½¿ç”¨<code>first</code>,<code>top</code> ä»¥åŠ <code>Distinct</code> å…³é”®å­—æ¥é™åˆ¶æŸ¥è¯¢ç»“æœï¼Œå¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">User</span> <span class="token function">findFirstByUsernameOrderByUsernameAsc</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findTop10ByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findTop10ByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="è‡ªå®šä¹‰æŸ¥è¯¢using-query"><a href="#è‡ªå®šä¹‰æŸ¥è¯¢using-query" class="header-anchor">#</a> è‡ªå®šä¹‰æŸ¥è¯¢Using @Query</h4> <p><code>@Query</code> æ³¨è§£çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€åœ¨å£°æ˜çš„æ–¹æ³•ä¸Šé¢æ ‡æ³¨è¯¥æ³¨è§£ï¼ŒåŒæ—¶æä¾›ä¸€ä¸ª <code>JPQL</code> æŸ¥è¯¢è¯­å¥å³å¯</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.email = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> eamil<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username = ?1 and u.password = ?2&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getByUsernameAndPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username like %?1%&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="ä½¿ç”¨å‘½åå‚æ•°using-named-parameters"><a href="#ä½¿ç”¨å‘½åå‚æ•°using-named-parameters" class="header-anchor">#</a> ä½¿ç”¨å‘½åå‚æ•°Using Named Parameters</h4> <p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>Spring Data JPA</code> ä½¿ç”¨åŸºäºä½ç½®çš„å‚æ•°ç»‘å®šï¼Œå¦‚å‰é¢æ‰€æœ‰ç¤ºä¾‹ä¸­æ‰€è¿°ã€‚ è¿™ä½¿å¾—æŸ¥è¯¢æ–¹æ³•åœ¨é‡æ„å‚æ•°ä½ç½®æ—¶å®¹æ˜“å‡ºé”™ã€‚ è¦è§£å†³æ­¤é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ <code>@Param</code> æ³¨è§£ä¸ºæ–¹æ³•å‚æ•°æŒ‡å®šå…·ä½“åç§°å¹¶åœ¨æŸ¥è¯¢ä¸­ç»‘å®šåç§°ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.id = :id&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username = :username or u.email = :email&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getByUsernameOrEmail</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="using-spel-expressions"><a href="#using-spel-expressions" class="header-anchor">#</a> Using SpEL Expressions</h4> <p>ä» <code>Spring Data JPA release 1.4</code> å¼€å§‹ï¼Œ<code>Spring Data JPA</code> æ”¯æŒåä¸º <code>entityName</code> çš„å˜é‡ã€‚ å®ƒçš„ç”¨æ³•æ˜¯<code>select x from #{#entityName} x</code>ã€‚</p> <p><code>entityName</code>çš„è§£ææ–¹å¼å¦‚ä¸‹ï¼šå¦‚æœå®ä½“ç±»åœ¨ <code>@Entity</code> æ³¨è§£ä¸Šè®¾ç½®äº†<code>name</code>å±æ€§ï¼Œåˆ™ä½¿ç”¨å®ƒã€‚å¦åˆ™ï¼Œä½¿ç”¨å®ä½“ç±»çš„ç®€å•ç±»åã€‚ä¸ºé¿å…åœ¨ <code>@Query</code> æ³¨è§£ä½¿ç”¨å®é™…çš„å®ä½“ç±»åï¼Œå°±å¯ä»¥ä½¿ç”¨<code>#{#entityName}</code>è¿›è¡Œä»£æ›¿ã€‚å¦‚ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œ<code>@Query</code>æ³¨è§£çš„æŸ¥è¯¢å­—ç¬¦ä¸²é‡Œçš„Useréƒ½å¯æ›¿æ¢ä¸º<code>#{#entityName}</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from #{#entityName} u where u.email = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">getByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> eamil<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="åŸç”ŸæŸ¥è¯¢native-queries"><a href="#åŸç”ŸæŸ¥è¯¢native-queries" class="header-anchor">#</a> åŸç”ŸæŸ¥è¯¢Native Queries</h4> <p><code>@Query</code> æ³¨è§£è¿˜æ”¯æŒé€šè¿‡å°† <code>nativeQuery</code> æ ‡å¿—è®¾ç½®ä¸º<code>true</code>æ¥æ‰§è¡ŒåŸç”ŸæŸ¥è¯¢ï¼ŒåŒæ ·æ”¯æŒåŸºäºä½ç½®çš„å‚æ•°ç»‘å®šåŠå‘½åå‚æ•°ï¼Œå¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from tb_user u where u.email = ?1&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">queryByEmail</span><span class="token punctuation">(</span><span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from tb_user u where u.email = :email&quot;</span><span class="token punctuation">,</span> nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">User</span> <span class="token function">queryByEmail</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
æ³¨æ„ï¼š<span class="token class-name">Spring</span> <span class="token class-name">Data</span> <span class="token class-name">Jpa</span>ç›®å‰ä¸æ”¯æŒå¯¹åŸç”ŸæŸ¥è¯¢è¿›è¡ŒåŠ¨æ€æ’åºï¼Œä½†å¯ä»¥é€šè¿‡è‡ªå·±æŒ‡å®šè®¡æ•°æŸ¥è¯¢countQueryæ¥ä½¿ç”¨åŸç”ŸæŸ¥è¯¢è¿›è¡Œåˆ†é¡µ<span class="token punctuation">,</span>æ’åºï¼Œå¦‚ï¼š

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;select * from tb_user u where u.username like %?1%&quot;</span><span class="token punctuation">,</span>
            countQuery <span class="token operator">=</span> <span class="token string">&quot;select count(1) from tb_user u where u.username = %?1%&quot;</span><span class="token punctuation">,</span>
            nativeQuery <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="åˆ†é¡µæŸ¥è¯¢åŠæ’åº"><a href="#åˆ†é¡µæŸ¥è¯¢åŠæ’åº" class="header-anchor">#</a> åˆ†é¡µæŸ¥è¯¢åŠæ’åº</h4> <p><code>Spring Data Jpa</code> å¯ä»¥åœ¨æ–¹æ³•å‚æ•°ä¸­ç›´æ¥ä¼ å…¥<code>Pageable</code> æˆ– <code>Sort</code> æ¥å®ŒæˆåŠ¨æ€åˆ†é¡µæˆ–æ’åºï¼Œé€šå¸¸ <code>Pageable</code> æˆ– <code>Sort</code> ä¼šæ˜¯æ–¹æ³•çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œå¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username like %?1%&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">Page</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Pageable</span> pageable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;select u from User u where u.username like %?1%&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUsernameAndSort</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">Sort</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é‚£è°ƒç”¨<code>repository</code>æ–¹æ³•æ—¶ä¼ å…¥ä»€ä¹ˆå‚æ•°å‘¢ï¼Ÿ</p> <p>å¯¹äº <code>Pageable</code> å‚æ•°ï¼Œåœ¨Spring Data 2.0ä¹‹å‰æˆ‘ä»¬å¯ä»¥newä¸€ä¸ª<code>org.springframework.data.domain.PageRequest</code>å¯¹è±¡ï¼Œç°åœ¨è¿™äº›æ„é€ æ–¹æ³•å·²ç»åºŸå¼ƒï¼Œå–è€Œä»£ä¹‹Springæ¨èæˆ‘ä»¬ä½¿ç”¨ <code>PageRequest</code> çš„ <code>of</code> æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">PageRequest</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Sort</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">Sort</span><span class="token punctuation">.</span><span class="token function">by</span><span class="token punctuation">(</span><span class="token class-name">Sort<span class="token punctuation">.</span>Direction</span><span class="token punctuation">.</span>ASC<span class="token punctuation">,</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>æ³¨æ„ï¼š<code>Spring Data PageRequest</code>çš„<code>page</code>å‚æ•°æ˜¯ä»<code>0</code>å¼€å§‹çš„ zero-based page index</p></blockquote> <p>å¯¹äº<code>Sort</code>å‚æ•°ï¼ŒåŒæ ·å¯ä»¥newä¸€ä¸ª<code>org.springframework.data.domain.Sort</code>ï¼Œä½†æ¨èä½¿ç”¨<code>Sort.by</code>æ–¹æ³•</p> <h4 id="è‡ªå®šä¹‰ä¿®æ”¹-åˆ é™¤-modifying-queries"><a href="#è‡ªå®šä¹‰ä¿®æ”¹-åˆ é™¤-modifying-queries" class="header-anchor">#</a> è‡ªå®šä¹‰ä¿®æ”¹,åˆ é™¤ Modifying Queries</h4> <p>å•ç‹¬ä½¿ç”¨ <code>@Query</code> æ³¨è§£åªæ˜¯æŸ¥è¯¢ï¼Œå¦‚æ¶‰åŠåˆ°ä¿®æ”¹,åˆ é™¤åˆ™éœ€è¦å†åŠ ä¸Š <code>@Modifying</code> æ³¨è§£ï¼Œå¦‚ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Modifying</span>
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;update User u set u.password = ?2 where u.username = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">updatePasswordByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Transactional</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Modifying</span>
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">&quot;delete from User where username = ?1&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">void</span> <span class="token function">deleteByUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>æ³¨æ„ï¼šModifying queries can only use void or int/Integer as return type!</p></blockquote> <h3 id="å¤šè¡¨æŸ¥è¯¢"><a href="#å¤šè¡¨æŸ¥è¯¢" class="header-anchor">#</a> å¤šè¡¨æŸ¥è¯¢</h3> <p>è¿™é‡Œä½¿ç”¨çº§è”æŸ¥è¯¢è¿›è¡Œå¤šè¡¨çš„å…³è”æŸ¥è¯¢</p> <h4 id="å¤šå¯¹å¤š"><a href="#å¤šå¯¹å¤š" class="header-anchor">#</a> å¤šå¯¹å¤š</h4> <p><code>/src/main/java/com/example/springbootjpa/entity/User</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>targetEntity <span class="token operator">=</span> <span class="token class-name">Role</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>PERSIST<span class="token punctuation">,</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>MERGE<span class="token punctuation">}</span><span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user_role&quot;</span><span class="token punctuation">,</span> joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><code>/src/main/java/com/example/springbootjpa/entity/Role</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_role&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_name&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> roleName<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&quot;40289f0c65674a930165674d54940000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸å‡ºæ„å¤–ä¼šæŠ¥ <code>Hibernate</code> æ‡’åŠ è½½å¼‚å¸¸ï¼Œæ— æ³•åˆå§‹åŒ–ä»£ç†ç±»ï¼ŒNo Sessionï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span></span>LazyInitializationException</span><span class="token operator">:</span> failed <span class="token keyword">to</span> <span class="token namespace">lazily</span> initialize a collection of role<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span>User</span><span class="token punctuation">.</span>roles<span class="token punctuation">,</span> could not initialize proxy <span class="token operator">-</span> no <span class="token class-name">Session</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>åŸå› ï¼š<code>Spring Boot</code> æ•´åˆ <code>JPA</code> å <code>Hibernate</code> çš„ <code>Session</code> å°±äº¤ä»˜ç»™Springå»ç®¡ç†ã€‚æ¯æ¬¡æ•°æ®åº“æ“ä½œåï¼Œä¼šå…³é—­<code>Session</code>ï¼Œå½“æˆ‘ä»¬æƒ³è¦ç”¨æ‡’åŠ è½½æ–¹å¼å»è·å¾—æ•°æ®çš„æ—¶å€™ï¼ŒåŸæ¥çš„<code>Session</code>å·²ç»å…³é—­ï¼Œä¸èƒ½è·å–æ•°æ®ï¼Œæ‰€ä»¥ä¼šæŠ›å‡ºè¿™æ ·çš„å¼‚å¸¸ã€‚</p> <p>è§£å†³æ–¹æ³•ï¼š
åœ¨<code>application.yml</code>ä¸­åšå¦‚ä¸‹é…ç½®ï¼š</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jpa</span><span class="token punctuation">:</span>
    <span class="token key atrule">open-in-view</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">properties</span><span class="token punctuation">:</span>
      <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
        <span class="token key atrule">enable_lazy_load_no_trans</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="ä¸€å¯¹å¤š-å¤šå¯¹ä¸€"><a href="#ä¸€å¯¹å¤š-å¤šå¯¹ä¸€" class="header-anchor">#</a> ä¸€å¯¹å¤šï¼ˆå¤šå¯¹ä¸€ï¼‰</h4> <p><code>/src/main/java/com/example/springbootjpa/entity/Department</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_dept&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dept_name&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deptName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">&quot;department&quot;</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>/src/main/java/com/example/springbootjpa/entity/Employee</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>UUID<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_emp&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;emp_name&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> empName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;emp_job&quot;</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> empJob<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dept_id&quot;</span><span class="token punctuation">,</span> insertable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> deptId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>targetEntity <span class="token operator">=</span> <span class="token class-name">Department</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;dept_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Department</span> department<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>æµ‹è¯•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> employeeRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&quot;93fce66c1ef340fa866d5bd389de3d79&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç»“æœæŠ¥é”™äº†...</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>StackOverflowError</span>
    at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Exception</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Exception</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">102</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ReflectiveOperationException</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">ReflectiveOperationException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">89</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>InvocationTargetException</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span>init<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">73</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">jdk<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>GeneratedConstructorAccessor54</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Unknown</span> <span class="token class-name">Source</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">jdk<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>DelegatingConstructorAccessorImpl</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">DelegatingConstructorAccessorImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">)</span>
    at java<span class="token punctuation">.</span>base<span class="token operator">/</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span>Constructor</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Constructor</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">488</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Util</span><span class="token punctuation">.</span><span class="token function">handleNewInstance</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">425</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>PreparedStatement</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">761</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ConnectionImpl</span><span class="token punctuation">.</span><span class="token function">clientPrepareStatement</span><span class="token punctuation">(</span><span class="token class-name">ConnectionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1404</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ConnectionImpl</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">ConnectionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">4121</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ConnectionImpl</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">ConnectionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">4025</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>ProxyConnection</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">ProxyConnection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">318</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>HikariProxyConnection</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">HikariProxyConnection</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>StatementPreparerImpl</span>$<span class="token number">5.</span><span class="token function">doPrepare</span><span class="token punctuation">(</span><span class="token class-name">StatementPreparerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">145</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>StatementPreparerImpl</span>$<span class="token class-name">StatementPreparationTemplate</span><span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token class-name">StatementPreparerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">171</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>StatementPreparerImpl</span><span class="token punctuation">.</span><span class="token function">prepareQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">StatementPreparerImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">147</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">prepareQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">226</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">190</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeLoad</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">121</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeLoad</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">86</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>plan<span class="token punctuation">.</span></span>AbstractLoadPlanBasedCollectionInitializer</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedCollectionInitializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">87</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>persister<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span>AbstractCollectionPersister</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractCollectionPersister</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">688</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>event<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>DefaultInitializeCollectionEventListener</span><span class="token punctuation">.</span><span class="token function">onInitializeCollection</span><span class="token punctuation">(</span><span class="token class-name">DefaultInitializeCollectionEventListener</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>SessionImpl</span><span class="token punctuation">.</span><span class="token function">initializeCollection</span><span class="token punctuation">(</span><span class="token class-name">SessionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2223</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span>$<span class="token number">4.</span><span class="token function">doWork</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">565</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">withTemporarySessionIfNeeded</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">247</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">561</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">132</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>PersistentSet</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">PersistentSet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">430</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span>Department</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>é€šè¿‡æ—¥å¿—çœ‹sqlçš„è¾“å‡ºï¼Œå‘ç°äº†sqlé‡å¤æ‰§è¡Œäº†å¥½å¤šæ¬¡ã€‚ä»¥ä¸‹æˆ‘æˆªå–äº†å‰10æ¡sqlè®°å½•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hibernate</span><span class="token operator">:</span> select employee0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>emp_job as emp_job3_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>emp_name as emp_name4_1_0_ from tb_emp employee0_ where employee0_<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select department0_<span class="token punctuation">.</span>id as id1_0_0_<span class="token punctuation">,</span> department0_<span class="token punctuation">.</span>dept_name as dept_nam2_0_0_ from tb_dept department0_ where department0_<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select department0_<span class="token punctuation">.</span>id as id1_0_0_<span class="token punctuation">,</span> department0_<span class="token punctuation">.</span>dept_name as dept_nam2_0_0_ from tb_dept department0_ where department0_<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>id as id1_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>dept_id as dept_id2_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_job as emp_job3_1_1_<span class="token punctuation">,</span> employees0_<span class="token punctuation">.</span>emp_name as emp_name4_1_1_ from tb_emp employees0_ where employees0_<span class="token punctuation">.</span>dept_id<span class="token operator">=</span><span class="token operator">?</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>é€šè¿‡è§‚å¯Ÿå‘ç°ï¼Œç¬¬ä¸€æ¡sqlæ˜¯æ‰§è¡ŒæŸ¥è¯¢Employeeçš„sqlï¼Œç¬¬äºŒæ¡sqlæ˜¯æ‰§è¡ŒæŸ¥è¯¢Departmentçš„sqlï¼Œç¬¬ä¸‰æ¡sqlæ˜¯æ‰§è¡ŒDepartmenté‡Œé¢æ‰€æœ‰å‘˜å·¥çš„sqlï¼Œç¬¬å››æ¡sqlæ˜¯æ‰§è¡ŒæŸ¥è¯¢Departmentçš„sqlï¼Œåé¢æ‰€æœ‰çš„sqléƒ½æ˜¯æ‰§è¡ŒæŸ¥è¯¢Departmenté‡Œé¢æ‰€æœ‰å‘˜å·¥çš„sqlã€‚</p> <p>å¾ˆæ˜æ˜¾å‘ç”Ÿäº†å¾ªç¯ä¾èµ–çš„æƒ…å†µã€‚è¿™æ˜¯<code>Lombok</code>çš„<code>@Data</code>æ³¨è§£çš„é”…ã€‚<code>Lombok</code>çš„<code>@Data</code>æ³¨è§£ç›¸å½“äº<code>@Getter</code>,<code>@Setter</code>,<code>@RequiredArgsConstructor</code>,<code>@ToString</code>,<code>@EqualsAndHashCode</code>è¿™å‡ ä¸ªæ³¨è§£ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åç¼–è¯‘çœ‹ä¸€ä¸‹<code>Lombok</code>ç”Ÿæˆçš„<code>toString()</code>æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Employee</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;Employee(id=&quot;</span> <span class="token operator">+</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, empName=&quot;</span> <span class="token operator">+</span> <span class="token function">getEmpName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, empJob=&quot;</span> <span class="token operator">+</span> <span class="token function">getEmpJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, deptId=&quot;</span> <span class="token operator">+</span> <span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, department=&quot;</span> <span class="token operator">+</span> <span class="token function">getDepartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Department</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">&quot;Department(id=&quot;</span> <span class="token operator">+</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, deptName=&quot;</span> <span class="token operator">+</span> <span class="token function">getDeptName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, employees=&quot;</span> <span class="token operator">+</span> <span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¯ä»¥å‘ç°<code>Lombok</code>ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„<code>toString()</code>æ–¹æ³•è¦†ç›–äº†æ•´ä¸ªç±»çš„æ‰€æœ‰å±æ€§
ç°åœ¨å°† <code>@Data</code> æ³¨è§£å»æ‰ï¼Œæ›¿æ¢ä¸º <code>@Setter</code>,<code>@Getter</code>,<code>@EqualsAndHashCode</code>ï¼Œé‡å†™ <code>toString()</code> æ–¹æ³•</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Department</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Department{&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;id='&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">&quot;, deptName='&quot;</span> <span class="token operator">+</span> deptName <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">'}'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Employee</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Employee{&quot;</span> <span class="token operator">+</span>
            <span class="token string">&quot;id='&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">&quot;, empName='&quot;</span> <span class="token operator">+</span> empName <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">&quot;, empJob='&quot;</span> <span class="token operator">+</span> empJob <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">&quot;, deptId='&quot;</span> <span class="token operator">+</span> deptId <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>
            <span class="token string">&quot;, department=&quot;</span> <span class="token operator">+</span> department <span class="token operator">+</span>
            <span class="token string">'}'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>å†æ¬¡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•é€šè¿‡ï¼Œä»¥ä¸ŠEmployee toString()æ–¹æ³•æ‰“å°çš„departmentä¼šè§¦å‘æ‡’åŠ è½½ï¼Œæœ€ç»ˆæ—¥å¿—è¾“å‡ºçš„sqlå¦‚ä¸‹ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Hibernate</span><span class="token operator">:</span> select employee0_<span class="token punctuation">.</span>id as id1_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>dept_id as dept_id2_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>emp_job as emp_job3_1_0_<span class="token punctuation">,</span> employee0_<span class="token punctuation">.</span>emp_name as emp_name4_1_0_ from tb_emp employee0_ where employee0_<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Hibernate</span><span class="token operator">:</span> select department0_<span class="token punctuation">.</span>id as id1_0_0_<span class="token punctuation">,</span> department0_<span class="token punctuation">.</span>dept_name as dept_nam2_0_0_ from tb_dept department0_ where department0_<span class="token punctuation">.</span>id<span class="token operator">=</span><span class="token operator">?</span>
<span class="token class-name">Employee</span><span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token string">'93fce66c1ef340fa866d5bd389de3d79'</span><span class="token punctuation">,</span> empName<span class="token operator">=</span><span class="token string">'jack'</span><span class="token punctuation">,</span> empJob<span class="token operator">=</span><span class="token string">'hr'</span><span class="token punctuation">,</span> deptId<span class="token operator">=</span><span class="token string">'0a4fe7234fff42afad34f6a06a8e1821'</span><span class="token punctuation">,</span> department<span class="token operator">=</span><span class="token class-name">Department</span><span class="token punctuation">{</span>id<span class="token operator">=</span><span class="token string">'0a4fe7234fff42afad34f6a06a8e1821'</span><span class="token punctuation">,</span> deptName<span class="token operator">=</span><span class="token string">'äººäº‹éƒ¨'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å†æ¥æµ‹è¯•æŸ¥è¯¢Department</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">findByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> departmentRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&quot;0a4fe7234fff42afad34f6a06a8e1821&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span></span> employees <span class="token operator">=</span> optional<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotEquals</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> employees<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŒæ ·è¿˜æ˜¯æŠ¥äº†å †æ ˆæº¢å‡ºï¼Œé”™è¯¯å®šä½åœ¨Departmentå’ŒEmployeeçš„hashCode()æ–¹æ³•ä¸Š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>StackOverflowError</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>Util</span><span class="token punctuation">.</span><span class="token function">handleNewInstance</span><span class="token punctuation">(</span><span class="token class-name">Util</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">439</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ResultSetImpl</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">ResultSetImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">342</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>MysqlIO</span><span class="token punctuation">.</span><span class="token function">buildResultSetWithRows</span><span class="token punctuation">(</span><span class="token class-name">MysqlIO</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3132</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>MysqlIO</span><span class="token punctuation">.</span><span class="token function">getResultSet</span><span class="token punctuation">(</span><span class="token class-name">MysqlIO</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">477</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>MysqlIO</span><span class="token punctuation">.</span><span class="token function">readResultsForQueryOrUpdate</span><span class="token punctuation">(</span><span class="token class-name">MysqlIO</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">3115</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>MysqlIO</span><span class="token punctuation">.</span><span class="token function">readAllResults</span><span class="token punctuation">(</span><span class="token class-name">MysqlIO</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2344</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>MysqlIO</span><span class="token punctuation">.</span><span class="token function">sqlQueryDirect</span><span class="token punctuation">(</span><span class="token class-name">MysqlIO</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2739</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>ConnectionImpl</span><span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token class-name">ConnectionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2486</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>PreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeInternal</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1858</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>mysql<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span></span>PreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">PreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1966</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>ProxyPreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">ProxyPreparedStatement</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">52</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zaxxer<span class="token punctuation">.</span>hikari<span class="token punctuation">.</span>pool<span class="token punctuation">.</span></span>HikariProxyPreparedStatement</span><span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token class-name">HikariProxyPreparedStatement</span><span class="token punctuation">.</span>java<span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>jdbc<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>ResultSetReturnImpl</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">ResultSetReturnImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">getResultSet</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">419</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeQueryStatement</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">191</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeLoad</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">121</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>plan<span class="token punctuation">.</span>exec<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span><span class="token function">executeLoad</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedLoader</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">86</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>plan<span class="token punctuation">.</span></span>AbstractLoadPlanBasedCollectionInitializer</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractLoadPlanBasedCollectionInitializer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">87</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>persister<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span>AbstractCollectionPersister</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractCollectionPersister</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">688</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>event<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>DefaultInitializeCollectionEventListener</span><span class="token punctuation">.</span><span class="token function">onInitializeCollection</span><span class="token punctuation">(</span><span class="token class-name">DefaultInitializeCollectionEventListener</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">75</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>SessionImpl</span><span class="token punctuation">.</span><span class="token function">initializeCollection</span><span class="token punctuation">(</span><span class="token class-name">SessionImpl</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2223</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span>$<span class="token number">4.</span><span class="token function">doWork</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">565</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">withTemporarySessionIfNeeded</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">247</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">561</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>AbstractPersistentCollection</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">AbstractPersistentCollection</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">132</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>collection<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>PersistentSet</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">PersistentSet</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">430</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span>Department</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">17</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>ä¾æ—§æ˜¯<code>Lombok</code>çš„é”…ï¼Œ<code>@EqualsAndHashCode</code>ä¸ºæˆ‘ä»¬ç”Ÿæˆçš„<code>equals()</code>å’Œ<code>hashCode()</code>æ–¹æ³•ä¼šä½¿ç”¨æ‰€æœ‰å±æ€§ï¼Œæ³¨æ„ï¼Œ<code>Department</code>ä¸­<code>employees</code>æ˜¯<code>Se</code>té›†åˆï¼Œå½“æˆ‘ä»¬è°ƒç”¨<code>department.getEmployees()</code>æ—¶ï¼Œ<code>Employee</code>çš„<code>hashCode()</code>æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œ<code>Employee</code>ä¸­çš„<code>hashCode()</code>åˆä¾èµ–äº<code>Department</code>çš„<code>HashCode()</code>æ–¹æ³•ï¼Œè¿™æ ·åˆå½¢æˆäº†å¾ªç¯å¼•ç”¨...</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Department</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">43</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $id <span class="token operator">=</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>$id <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $id<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">59</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $deptName <span class="token operator">=</span> <span class="token function">getDeptName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>$deptName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $deptName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span> $employees <span class="token operator">=</span> <span class="token function">getEmployees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i2 <span class="token operator">=</span> result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$employees <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> $employees<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> i2 <span class="token operator">+</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Employee</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">43</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $id <span class="token operator">=</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>$id <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $id<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">59</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $empName <span class="token operator">=</span> <span class="token function">getEmpName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>$empName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $empName<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $empJob <span class="token operator">=</span> <span class="token function">getEmpJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>$empJob <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $empJob<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> $deptId <span class="token operator">=</span> <span class="token function">getDeptId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>$deptId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">43</span> <span class="token operator">:</span> $deptId<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> $department <span class="token operator">=</span> <span class="token function">getDepartment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i2 <span class="token operator">=</span> result <span class="token operator">*</span> <span class="token number">59</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>$department <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i <span class="token operator">=</span> $department<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> i2 <span class="token operator">+</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>è‡ªå·±åŠ¨æ‰‹é‡å†™ <code>equals()</code> å’Œ <code>hashCode()</code> æ–¹æ³•ï¼Œå»æ‰ <code>@EqualsAndHashCode</code> æ³¨è§£</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Department</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Department</span> that <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Department</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> that<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>deptName<span class="token punctuation">,</span> that<span class="token punctuation">.</span>deptName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> deptName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Employee</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token class-name">Employee</span> employee <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> employee<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>empName<span class="token punctuation">,</span> employee<span class="token punctuation">.</span>empName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>empJob<span class="token punctuation">,</span> employee<span class="token punctuation">.</span>empJob<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
            <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>deptId<span class="token punctuation">,</span> employee<span class="token punctuation">.</span>deptId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> empName<span class="token punctuation">,</span> empJob<span class="token punctuation">,</span> deptId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>å†æ¬¡è¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæµ‹è¯•é€šè¿‡</p> <blockquote><p>æ€»ç»“ï¼šæ…ç”¨ <code>@Data</code> æ³¨è§£ï¼Œä½¿ç”¨ <code>@Getter</code>,<code>@Setter</code>æ³¨è§£ï¼Œéœ€è¦æ—¶è‡ªå·±é‡å†™ <code>toString()</code>,<code>equals()</code>ä»¥åŠ <code>hashCode()</code>æ–¹æ³•</p></blockquote> <h2 id="å®¡è®¡auditing"><a href="#å®¡è®¡auditing" class="header-anchor">#</a> å®¡è®¡Auditing</h2> <p>å‚è€ƒè‡ª<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#auditing" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£5.9Auditing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>ä¸€èˆ¬æ•°æ®åº“è¡¨åœ¨è®¾è®¡æ—¶éƒ½ä¼šæ·»åŠ 4ä¸ªå®¡è®¡å­—æ®µï¼Œ<code>Spring Data Jpa</code> åŒæ ·æ”¯æŒå®¡è®¡åŠŸèƒ½ã€‚<code>Spring Data</code> æä¾›äº†<code>@CreatedBy</code>ï¼Œ<code>@LastModifiedBy</code>ï¼Œ<code>@CreatedDate</code>ï¼Œ<code>@LastModifiedDate</code> 4ä¸ªæ³¨è§£æ¥è®°å½•è¡¨ä¸­è®°å½•çš„åˆ›å»ºåŠä¿®æ”¹ä¿¡æ¯ã€‚</p> <p><strong>å®ä½“ç±»</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>hibernate<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">GenericGenerator</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CreatedBy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">CreatedDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">LastModifiedBy</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">LastModifiedDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GenericGenerator</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">,</span> strategy <span class="token operator">=</span> <span class="token string">&quot;uuid&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>generator <span class="token operator">=</span> <span class="token string">&quot;idGenerator&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span> unique <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>targetEntity <span class="token operator">=</span> <span class="token class-name">Role</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;tb_user_role&quot;</span><span class="token punctuation">,</span> joinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;role_id&quot;</span><span class="token punctuation">,</span> referencedColumnName <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@CreatedDate</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;created_date&quot;</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createdDate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@CreatedBy</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;created_by&quot;</span><span class="token punctuation">,</span> updatable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> createdBy<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@LastModifiedDate</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;updated_date&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updatedDate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@LastModifiedBy</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;updated_by&quot;</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> updatedBy<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><p>å®ä½“ç±»ä¸Šè¿˜æ·»åŠ äº† <code>@EntityListeners(AuditingEntityListener.class)</code>ï¼Œè€Œ <code>AuditingEntityListener</code> æ˜¯ç”± <code>Spring Data Jpa</code> æä¾›çš„</p> <h3 id="å®ç°auditorawareæ¥å£"><a href="#å®ç°auditorawareæ¥å£" class="header-anchor">#</a> å®ç°AuditorAwareæ¥å£</h3> <p>å…‰æ·»åŠ äº†4ä¸ªå®¡è®¡æ³¨è§£è¿˜ä¸å¤Ÿï¼Œå¾—å‘Šè¯‰ç¨‹åºåˆ°åº•æ˜¯è°åœ¨åˆ›å»ºå’Œä¿®æ”¹è¡¨è®°å½•</p> <p><code>/src/main/java/com/example/springbootjpa/auditing/AuditorAwareImpl</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa<span class="token punctuation">.</span>auditing</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">AuditorAware</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Optional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AuditorAwareImpl</span> <span class="token keyword">implements</span> <span class="token class-name">AuditorAware</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCurrentAuditor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>è¿™é‡Œç®€å•çš„è¿”å›äº†ä¸€ä¸ª&quot;admin&quot;å­—ç¬¦ä¸²æ¥ä»£è¡¨å½“å‰ç”¨æˆ·å</p> <h3 id="å¯ç”¨jpaå®¡è®¡åŠŸèƒ½"><a href="#å¯ç”¨jpaå®¡è®¡åŠŸèƒ½" class="header-anchor">#</a> å¯ç”¨Jpaå®¡è®¡åŠŸèƒ½</h3> <p>åœ¨<code>Spring Boot</code>å¯åŠ¨ç±»ä¸Šæ·»åŠ  <code>@EnableJpaAuditing</code> æ³¨è§£ç”¨äºå¯ç”¨Jpaçš„å®¡è®¡åŠŸèƒ½</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>springbootjpa</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">EnableJpaAuditing</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableJpaAuditing</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBootJpaApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">SpringBootJpaApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>æ›´å¤šå…³äº<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#specifications" target="_blank" rel="noopener noreferrer">Jpa Specifications<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#query-by-example" target="_blank" rel="noopener noreferrer">Example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æŸ¥è¯¢è¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/herodotus-cloud/eurynome-cloud/edit/main/knowledge/spring-data-jpa.md" target="_blank" rel="noopener noreferrer">ç¼–è¾‘æ­¤é¡µ</a></div> <div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº:</span> <span class="info">2021å¹´10æœˆ28æ—¥ 23:24</span></div> <div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span> <span class="info"><span title="email: pointer_v@qq.com" class="contributor">
          herodotus
        </span> <!----></span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/knowledge/postgresql/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        ä¸ºä»€ä¹ˆé»˜è®¤ä½¿ç”¨PostgreSQLæ•°æ®åº“ï¼Ÿ
      </a></span> <!----></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----><!----><div id="pwa-install"><!----> <div id="install-modal-wrapper" style="display:none;"><div class="background"></div> <div class="install-modal"><div class="header"><button aria-label="å…³é—­" class="close-button"><svg width="23" height="22" xmlns="http://www.w3.org/2000/svg" class="icon close-icon"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.12.358a1.224 1.224 0 011.729 0l8.92 8.914L20.686.358a1.224 1.224 0 011.73 1.728L13.497 11l8.92 8.913a1.222 1.222 0 11-1.73 1.729l-8.919-8.913-8.92 8.913a1.224 1.224 0 01-1.729-1.729L10.04 11l-8.92-8.914a1.222 1.222 0 010-1.728z" fill="currentColor"></path></svg></button> <div class="logo"><!----> <div class="title"><h1></h1> <p class="desc">è¯¥åº”ç”¨å¯ä»¥å®‰è£…åœ¨æ‚¨çš„ PC æˆ–ç§»åŠ¨è®¾å¤‡ä¸Šã€‚è¿™å°†ä½¿è¯¥ Web åº”ç”¨ç¨‹åºå¤–è§‚å’Œè¡Œä¸ºä¸å…¶ä»–åº”ç”¨ç¨‹åºç›¸åŒã€‚å®ƒå°†åœ¨å‡ºç°åœ¨åº”ç”¨ç¨‹åºåˆ—è¡¨ä¸­ï¼Œå¹¶å¯ä»¥å›ºå®šåˆ°ä¸»å±å¹•ï¼Œå¼€å§‹èœå•æˆ–ä»»åŠ¡æ ã€‚æ­¤ Web åº”ç”¨ç¨‹åºè¿˜å°†èƒ½å¤Ÿä¸å…¶ä»–åº”ç”¨ç¨‹åºå’Œæ‚¨çš„æ“ä½œç³»ç»Ÿå®‰å…¨åœ°è¿›è¡Œäº¤äº’ã€‚</p></div></div></div> <div class="content"><div class="highlight"><!----> <!----></div> <div class="description"><h3>è¯¦æƒ…</h3> <p></p></div></div> <div class="button-wrapper"><button class="install-button">
        å®‰è£… <span></span></button> <button class="cancel-button">
        å–æ¶ˆ
      </button></div></div></div></div><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button class="pswp__button pswp__button--close"></button> <button class="pswp__button pswp__button--share"></button> <button class="pswp__button pswp__button--fs"></button> <button class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button class="pswp__button pswp__button--arrow--left"></button> <button class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.572add54.js" defer></script><script src="/assets/js/vendors~layout-Layout.2bc900be.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.5e4e4962.js" defer></script><script src="/assets/js/page-SpringDataJPA.848e4b12.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound~layout-Slide.52f8b761.js" defer></script>
  </body>
</html>
